name: Build and Release

on:
  push:
    tags:
      - 'v*' # å½“æ¨é€æ ‡ç­¾vå¼€å¤´çš„tagæ—¶è§¦å‘ï¼ˆå¦‚v1.0.0ï¼‰
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pyinstaller pillow

      - name: Build with PyInstaller
        run: |
          pyinstaller --clean --noconsole --onefile --icon=icon.png --name=ScreenBrightnessTool-Windows --add-data "icon.png;." main.py
          
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: ScreenBrightnessTool-Windows
          path: dist/ScreenBrightnessTool-Windows.exe

  build-macos:
    runs-on: macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pyinstaller pillow

      - name: Build with PyInstaller
        run: |
          pyinstaller --clean --noconsole --onefile --name=ScreenBrightnessTool-macOS --add-data "icon.png:." main.py

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: ScreenBrightnessTool-macOS
          path: dist/ScreenBrightnessTool-macOS

  build-linux:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pyinstaller pillow

      - name: Build with PyInstaller
        run: |
          pyinstaller --clean --noconsole --onefile --name=ScreenBrightnessTool-Linux --add-data "icon.png:." main.py

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: ScreenBrightnessTool-Linux
          path: dist/ScreenBrightnessTool-Linux
          
  create-release:
    needs: [build-windows, build-macos, build-linux]
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Download artifacts
        uses: actions/download-artifact@v4

      - name: Create Release
        id: create_release
        uses: softprops/action-gh-release@v2
        with:
          files: |
            ScreenBrightnessTool-Windows/ScreenBrightnessTool-Windows.exe
            ScreenBrightnessTool-macOS/ScreenBrightnessTool-macOS
            ScreenBrightnessTool-Linux/ScreenBrightnessTool-Linux
          draft: false
          prerelease: false
          generate_release_notes: true
          body: |
            ## å±å¹•äº®åº¦è°ƒèŠ‚å·¥å…· / Screen Brightness Tool

            ### åŠŸèƒ½ç‰¹æ€§ / Features
            - ğŸ”† å±å¹•äº®åº¦è°ƒèŠ‚ / Screen brightness adjustment
            - ğŸ‘ï¸ æŠ¤çœ¼æ¨¡å¼ / Eye protection mode
            - ğŸŒ™ å¤œé—´æ¨¡å¼ / Night mode
            - ğŸ”µ é˜²è“å…‰æ¨¡å¼ / Blue light filter
            - â° å®šæ—¶åˆ‡æ¢ / Scheduled switching
            - ğŸ¨ æ‚¬æµ®çª—æ˜¾ç¤º / Floating window
            - ğŸ¯ åŒºåŸŸäº®åº¦è°ƒèŠ‚ / Area brightness adjustment
            - ğŸŒ“ æš—é»‘æ¨¡å¼ / Dark mode

            ### ä¸‹è½½è¯´æ˜ / Download Instructions
            - **Windows**: ä¸‹è½½ `ScreenBrightnessTool-Windows.exe`
            - **macOS**: ä¸‹è½½ `ScreenBrightnessTool-macOS`
            - **Linux**: ä¸‹è½½ `ScreenBrightnessTool-Linux`

            ### ä½¿ç”¨æ–¹æ³• / Usage
            1. ä¸‹è½½å¯¹åº”å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶
            2. åŒå‡»è¿è¡Œå³å¯ä½¿ç”¨
            3. Windowsç”¨æˆ·å¯èƒ½éœ€è¦å…è®¸é˜²ç«å¢™æƒé™

            ---

            **å®Œæ•´æ›´æ–°æ—¥å¿—è¯·æŸ¥çœ‹ä¸‹æ–¹è‡ªåŠ¨ç”Ÿæˆçš„å‘å¸ƒè¯´æ˜** 